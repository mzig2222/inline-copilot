async function d(t){try{await chrome.scripting.executeScript({target:{tabId:t},files:["content.js"]})}catch(e){console.warn("Injection failed:",e)}}chrome.commands.onCommand.addListener(async t=>{if(console.log("[Copilot] Command received:",t),t!=="toggle-overlay")return;const[e]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!(e!=null&&e.id)||!e.url){console.warn("[Copilot] No active tab found");return}if(e.url.startsWith("chrome://")||e.url.startsWith("chrome-extension://")||e.url.startsWith("about:")){console.warn("[Copilot] Cannot inject into restricted URL:",e.url);return}await d(e.id),console.log("[Copilot] Sending TOGGLE message to tab",e.id),chrome.tabs.sendMessage(e.id,{type:"TOGGLE"})});chrome.runtime.onConnect.addListener(t=>{t.name==="copilot"&&t.onMessage.addListener(async e=>{var r;if(e.type==="ask")try{const o=(r=(await fetch("http://localhost:3000/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({input:e.input,jwt:e.jwt})})).body)==null?void 0:r.getReader();if(!o)return t.postMessage({type:"done",error:"no stream"});const a=new TextDecoder;for(;;){const{done:i,value:c}=await o.read();if(i)break;const s=a.decode(c,{stream:!0});s&&t.postMessage({type:"delta",token:s})}t.postMessage({type:"done"})}catch(n){const o=n instanceof Error?n.message:String(n);t.postMessage({type:"done",error:o})}})});
//# sourceMappingURL=worker.js.map
