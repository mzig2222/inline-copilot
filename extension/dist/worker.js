async function d(e){try{await chrome.scripting.executeScript({target:{tabId:e},files:["content.js"]})}catch(t){console.warn("Injection failed:",t)}}chrome.commands.onCommand.addListener(async e=>{if(e!=="toggle-overlay")return;const[t]=await chrome.tabs.query({active:!0,currentWindow:!0});t!=null&&t.id&&(await d(t.id),chrome.tabs.sendMessage(t.id,{type:"TOGGLE"}))});chrome.runtime.onInstalled.addListener(()=>{console.log("Inline Copilot installed")});chrome.runtime.onConnect.addListener(e=>{e.name==="copilot"&&e.onMessage.addListener(async t=>{var o;if(t.type==="ask")try{const r=(o=(await fetch("http://localhost:3000/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({input:t.input})})).body)==null?void 0:o.getReader();if(!r)return e.postMessage({type:"done",error:"no stream"});const a=new TextDecoder;for(;;){const{done:i,value:c}=await r.read();if(i)break;const s=a.decode(c,{stream:!0});s&&e.postMessage({type:"delta",token:s})}e.postMessage({type:"done"})}catch(n){const r=n instanceof Error?n.message:String(n);e.postMessage({type:"done",error:r})}})});
//# sourceMappingURL=worker.js.map
