{"version":3,"file":"popup.js","sources":["../src/popup.tsx"],"sourcesContent":["import React, { useState } from \"react\";\nimport { createRoot } from \"react-dom/client\";\n\nfunction Popup() {\n  const [username, setUsername] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n  const [registerMode, setRegisterMode] = useState(false);\n  const [user, setUser] = useState(null);\n  const [apiKey, setApiKey] = useState(\"\");\n\n  const handleLogin = async () => {\n    console.log(\"Logging in with\", username);\n    const res = await fetch(\"http://localhost:3000/api/auth/login\", {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({ username, password }),\n    });\n    const data = await res.json();\n    console.log(\"Login response:\", data);\n    if (data.token) {\n        console.log(`Setting user token: ${data.token}`);\n      setUser(data.user);\n      chrome.storage.local.set({ jwt: data.token });\n    }\n  };\n\n  const handleRegister = async () => {\n    const res = await fetch(\"http://localhost:3000/api/auth/register\", {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({ username, password }),\n    });\n    const data = await res.json();\n    if (data.user) {\n      setRegisterMode(false);\n    }\n  };\n\n  const handleApiKeySave = async () => {\n    const token = await new Promise<string | null>((resolve) => {\n      chrome.storage.local.get([\"token\"], (result) => {\n        resolve(result.token || null);\n      });\n    });\n    if (!token) {\n      alert(\"You must be logged in to save your API key.\");\n      return;\n    }\n    const res = await fetch(\"http://localhost:3000/api/user/api-key\", {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        \"Authorization\": `Bearer ${token}`\n      },\n      body: JSON.stringify({ apiKey })\n    });\n    if (res.ok) {\n        alert(\"API key saved!\");\n    } else {\n        const errorText = await res.text();\n        alert(\"Failed to save API key: \" + errorText);\n    }\n  };\n\n  return (\n    <div style={{ padding: 16, minWidth: 320 }}>\n      <h2>Inline Copilot Login</h2>\n      {registerMode ? (\n        <form onSubmit={e => { e.preventDefault(); handleRegister(); }}>\n          <input value={username} onChange={e => setUsername(e.target.value)} placeholder=\"Username\" />\n          <input type=\"password\" value={password} onChange={e => setPassword(e.target.value)} placeholder=\"Password\" />\n          <button type=\"submit\">Register</button>\n          <button type=\"button\" onClick={() => setRegisterMode(false)}>Back to Login</button>\n        </form>\n      ) : (\n        <form onSubmit={e => { e.preventDefault(); handleLogin(); }}>\n          <input value={username} onChange={e => setUsername(e.target.value)} placeholder=\"Username\" />\n          <input type=\"password\" value={password} onChange={e => setPassword(e.target.value)} placeholder=\"Password\" />\n          <button type=\"submit\">Login</button>\n          <button type=\"button\" onClick={() => setRegisterMode(true)}>Register</button>\n        </form>\n      )}\n      {user && <div>Welcome, {user.username}</div>}\n      <div style={{ marginTop: 16 }}>\n        <input value={apiKey} onChange={e => setApiKey(e.target.value)} placeholder=\"OpenAI API Key\" />\n        <button onClick={handleApiKeySave}>Save API Key</button>\n      </div>\n    </div>\n  );\n}\n\ncreateRoot(document.getElementById(\"root\")!).render(<Popup />);\n"],"names":["Popup","username","setUsername","useState","password","setPassword","registerMode","setRegisterMode","user","setUser","apiKey","setApiKey","handleLogin","data","handleRegister","handleApiKeySave","token","resolve","result","res","errorText","jsxs","jsx","createRoot"],"mappings":"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"}